import { Grid } from 'components/Grid'
import { Layout } from 'components/Layout'
import { useAuth } from 'context/authContext'
import Head from 'next/head'
import { useRouter } from 'next/router'
import { useEffect, useState } from 'react'
import { getAllUserAlbums } from 'services/albums'
import { Album } from 'components/Album'

export default function Home() {
  const [albums, setAlbums] = useState([])
  const [loadingAlbums, setLoadingAlbums] = useState(true)
  console.log('ðŸš€ ~ file: index.js ~ line 13 ~ Home ~ albums', albums)
  const { user, isLoading } = useAuth()
  const router = useRouter()
  console.log('ðŸš€ ~ file: index.js ~ line 8 ~ Home ~ user', user)

  useEffect(() => {
    if (!isLoading && !user) {
      console.log('Theres no user :D')
      router.push('/explore')
    }

    const fetchAlbums = async () => {
      const { data, error } = await getAllUserAlbums(user.id)
      if (error) {
        console.log(error)
      }
      setAlbums(data)
      setLoadingAlbums(false)
    }

    user && fetchAlbums()
  }, [isLoading, router, user])

  return (
    <div className='bg-zinc-900 text-white'>
      <Head>
        <title>Social Album | home </title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <Layout>
        <h1 className='text-2xl lg:text-3xl my-2 py-6 font-bold'>
          Your Albums
        </h1>

        <Grid>
          {user && loadingAlbums
            ? Array(12)
                .fill('filled')
                .map((_e, i) => (
                  <div
                    key={i}
                    className='bg-zinc-700 w-full h-[150px] animate-pulse rounded'
                  ></div>
                ))
            : albums?.map((album) => <Album album={album} key={album.id} />)}
        </Grid>
      </Layout>
    </div>
  )
}
